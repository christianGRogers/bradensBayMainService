<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>VM Command Terminal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css"/>
</head>
<body>
    <main id="container">
        <div id="terminal">
            <!-- Terminal Bar -->
            <section id="terminal__bar">
                <div id="bar__buttons">
                    <button class="bar__button" id="bar__button--exit">&#10005;</button>
                    <button class="bar__button" id="bar__button--plus">+</button>
                </div>
                <p id="bar__user">user@bradensbay.com ~</p>
            </section>
            <!-- Terminal Body -->
            <section id="terminal__body">
                <div id="terminal__prompt">
                    <span id="terminal__prompt--user">username:</span>
                    <span id="terminal__prompt--location">~</span>
                    <span id="terminal__prompt--bling">$</span>
                    <input type="text" id="terminal__input" autofocus>
                </div>
            </section>
        </div>
    </main>

    <script type="module">
        document.addEventListener("DOMContentLoaded", () => {
            const inputField = document.getElementById("terminal__input");
            const terminalBody = document.getElementById("terminal__body");

            let vmName = "";

            inputField.addEventListener("keydown", (event) => {
                if (event.key === "Enter") {
                    const command = inputField.value.trim();
                    if (vmName === "") {
                        // First input is the VM name
                        vmName = command;
                        sendVMName(vmName);
                    } else {
                        // Subsequent inputs are commands
                        if (command.toLowerCase() === "exit") {
                            displayOutput("Exiting...");
                            return;
                        }
                        sendCommand(vmName, command);
                    }
                    inputField.value = "";
                }
            });

            async function sendVMName(vmName) {
                const url = 'http://localhost:8080';  // Replace with your server's address
                const postData = `vm=${encodeURIComponent(vmName)}`;

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: postData
                    });
                    if (!response.ok) throw new Error(`Server error: ${response.status}`);
                    displayOutput(`VM name sent: ${vmName}`);
                } catch (error) {
                    displayOutput(`Error sending VM name: ${error.message}`);
                }
            }

            async function sendCommand(vmName, command) {
                const url = 'http://localhost:8080';  // Replace with your server's address
                const postData = `vm=${encodeURIComponent(vmName)}&command=${encodeURIComponent(command)}`;

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: postData
                    });
                    if (!response.ok) throw new Error(`Server error: ${response.status}`);
                    const output = await response.text();
                    displayOutput(`VM output:\n${output}`);
                } catch (error) {
                    displayOutput(`Error sending command: ${error.message}`);
                }
            }

            function displayOutput(message) {
                const commandOutput = document.createElement("div");
                commandOutput.classList.add("terminal__output");
                commandOutput.innerHTML = `<span>${message}</span>`;
                terminalBody.insertBefore(commandOutput, document.getElementById("terminal__prompt"));
            }
        });
    </script>
</body>
</html>
